# CONFIGURATION -------------------------
_min_copier_version: "9"
_envops:
  autoescape: false
  keep_trailing_newline: true
_subdirectory: project
_templates_suffix: .jinja
_preserve_symlinks: true
_jinja_extensions:
  - copier_template_extensions.TemplateExtensionLoader
  - extensions.py:CurrentYearExtension
  - extensions.py:GitExtension
  - extensions.py:SlugifyExtension
_tasks:
  - when: "{{ not '.git' | path_exists }}"
    command: uv python pin 3.14
  - when: "{{ not '.git' | path_exists }}"
    command: uv sync
  - when: "{{ not '.git' | path_exists }}"
    command: git init -b main
  - when: "{{ not '.git' | path_exists }}"
    command: git add .
  - when: "{{ not '.git' | path_exists }}"
    command: 'git commit -m "chore: initial commit"'
  - when: "{{ not '.git' | path_exists }}"
    command: |
      if command -v gh >/dev/null 2>&1 && [ "{{ gh_repo_create | default('skip') }}" != "skip" ]; then
        visibility="--private"
        if [ "{{ gh_repo_create | default('skip') }}" = "public" ]; then
          visibility="--public"
        fi
        repo="{{ repository_namespace }}/{{ repository_name }}"
        url="git@github.com:${repo}.git"
        if gh repo view "$repo" >/dev/null 2>&1; then
          git remote add origin "$url" 2>/dev/null || git remote set-url origin "$url"
        else
          gh repo create "$repo" $visibility --description "{{ project_description }}" --homepage "https://{{ repository_namespace }}.github.io/{{ repository_name }}/" --source=. --remote=origin
        fi
        git push -u origin main
        gh repo edit "$repo" --enable-wiki=false --enable-projects=false >/dev/null 2>&1 || true
        # Enable Pages for workflow builds (required by deploy-pages).
        if gh api \
          --method POST \
          -H "Accept: application/vnd.github+json" \
          -H "X-GitHub-Api-Version: 2022-11-28" \
          "repos/${repo}/pages" \
          -f 'build_type=workflow' >/dev/null 2>&1; then
          echo "GitHub Pages enabled for ${repo}"
        else
          gh api \
            --method PUT \
            -H "Accept: application/vnd.github+json" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "repos/${repo}/pages" \
            -f 'build_type=workflow' >/dev/null 2>&1 || \
            echo "Warning: could not enable GitHub Pages. If the repository is private or Pages is restricted for your account, docs deployment will fail until Pages is allowed." >&2
        fi
        gh workflow run cd.yml --ref main || true
      fi

# PROMPT --------------------------------
project_name:
  type: str
  help: Your project name
  default: "{{ _copier_conf.dst_path.name | replace('-', ' ') | title }}"

project_description:
  type: str
  help: Your project description
  default: "The {{ project_name }} project"

author_fullname:
  type: str
  help: Your full name
  default: "{{ 'Martín Gaitán' | git_user_name }}"

author_email:
  type: str
  help: Your email
  default: "{{ 'gaitan@gmail.com' | git_user_email }}"

author_username:
  type: str
  help: GitHub username
  default: "{{ 'mgaitan' | gh_user_login }}"

gh_repo_create:
  type: str
  help: Create GitHub repository (requires gh)
  default: private
  when: "{{ 'gh' | command_available }}"
  choices:
    Public repo: public
    Private repo: private
    Skip: skip

python_package_distribution_name:
  type: str
  help: Your Python package distribution name (for `uv add NAME`)
  default: "{{ project_name | pypi_suggest_name }}"
  validator: "{{ '' if not (python_package_distribution_name | pypi_exists) else 'Name already exists on PyPI. Choose another distribution name.' }}"

python_package_import_name:
  type: str
  help: Your Python package import name (for `import NAME` in Python code)
  default: "{{ project_name | slugify('_') }}"

python_package_command_line_name:
  type: str
  help: Your CLI name if any (for use in the shell)
  default: "{{ project_name | slugify }}"


repository_namespace:
  type: str
  help: Github username or organization name
  default: "{{ author_username }}"
  when: false

repository_name:
  type: str
  help: Your repository name
  default: "{{ project_name | slugify }}"

copyright_license:
  type: str
  help: Your project's license
  default: BSD-3-Clause
  choices:
    BSD 3-Clause "New" or "Revised" License: BSD-3-Clause
    MIT License: MIT
    Apache License 2.0: Apache-2.0
